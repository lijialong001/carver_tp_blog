{include file="header" /}

<body class="layui-layout-body" style="font-family:华文中宋;margin-top: -15px">
{block name="pub"}

{/block}

<div class="layui-layout layui-layout-admin">
    <!--头部导航-->
    <div class="layui-header">
        <div class="layui-logo" style="color: white">Carver后台管理系统</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">

            <li class="layui-nav-item"><a href="{:url('index/adminIndex')}"><i class="iconfont">&#xe61b;</i>首页</a>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:void (0);"><i class="layui-icon layui-icon-group"></i>人员管理</a>
                <dl class="layui-nav-child"> <!-- 二级菜单 -->
                    <dd><a href="{:url('admin/adminList')}" style="text-decoration: none">用户列表</a></dd>
                    <dd><a href="{:url('admin/roleList')}" style="text-decoration: none">角色列表</a></dd>
                </dl>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:void (0);"><i class="iconfont">&#xe707;</i>内容管理</a>
                <dl class="layui-nav-child"> <!-- 二级菜单 -->
                    <dd><a href="{:url('article/articleList')}" style="text-decoration: none">文章管理</a></dd>
                </dl>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:void (0);"><i class="iconfont">&#xe618;</i>导航管理</a>
                <dl class="layui-nav-child"> <!-- 二级菜单 -->
                    <dd><a href="{:url('navigate/carouseList')}" style="text-decoration: none">前台轮播图管理</a></dd>
                    <dd><a href="{:url('navigate/navigateList')}" style="text-decoration: none">前台导航管理</a></dd>
                </dl>
            </li>


            <li class="layui-nav-item ">
                <a href="javascript:;" style="text-decoration: none"><i class="iconfont">&#xe6d7;</i>公告管理</a>
                <dl class="layui-nav-child">
                    <dd><a href="{:url('Notice/noticeList')}" style="text-decoration: none">公告列表</a></dd>
                </dl>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:;" style="text-decoration: none"><i class="iconfont">&#xe693;</i>友情管理</a>
                <dl class="layui-nav-child">
                    <dd><a href="{:url('link/linkList')}" style="text-decoration: none">
                        友情列表</a></dd>
                </dl>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:;" style="text-decoration: none"><i class="iconfont">&#xe6c6;</i>网站管理</a>
                <dl class="layui-nav-child">
                    <dd><a href="{:url('Site/index')}" style="text-decoration: none">网站配置</a>
                    </dd>
                </dl>
            </li>

            <li class="layui-nav-item">
                <a href="javascript:;" style="text-decoration: none"><i class="iconfont">&#xe640;</i>日志管理</a>
                <dl class="layui-nav-child">
                    <dd><a href="{:url('log/logActIndex')}" style="text-decoration: none">行为日志</a>
                    </dd>
                    <dd><a href="{:url('log/logSysIndex')}" style="text-decoration: none">系统日志</a>
                    </dd>
                </dl>
            </li>

        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item"><a href="/web/LoginUser/userIndex">前台首页</a></li>
            <li class="layui-nav-item">
                <a href="javascript:void (0);">
                    <img src="{$Request.session.admin_image}" class="layui-nav-img">
                    {$Request.session.admin_name}
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="{:url('admin/updateAdmin',['admin_id'=>$Request.session.admin_id])}"
                           up-id="{$Request.session.admin_id}"><i class="iconfont"
                                                                  style="width: 30px">&#xe887;</i>&nbsp;&nbsp;编辑资料</a>
                    </dd>
                </dl>
            </li>
            <input type="hidden" value="{$Request.session.login_num}" id="login_status">
            <li class="layui-nav-item" id="out_login"><a href="{:url('index/outLogin')}">退出登录</a></li>
        </ul>
    </div>


    <script>
        //导航必须引入的哟！！！
        layui.use('element', function () {
            var element = layui.element;
        });


        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toGMTString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function clearCookie(name) {
            setCookie(name, "", -1);
        }

    </script>

    <!--中间身体部分内容-->
    <div class="layui-body"
         style="background-image: url('__ADMIN__/img/index.jpg');background-repeat: no-repeat;background-position:
          center center; background-size: cover;height: 100%;width: 100%;margin-left: -199px">

        {block name="main"}

        <div id="main_body" style="float: left;">
            <span style="font-size: 25px;font-family: 华文楷体;"><b>首页信息</b></span><br><br>
            <hr
                    class="layui-bg-blue">
            <table class="table table-hover bg-success " lay-skin="line" style="border-radius: 10px;height: 322px">
                <tr>
                       <span style="font-size: 23px;font-family: 华文楷体"><span class="glyphicon glyphicon-cog"> <font
                               style="vertical-align：Inherit;"><font
                               style="vertical-align：Inherit;">数据统计</font></font></span></span></span>
                </tr>
                <tr>
                    <td>服务器ip地址</td>
                    <td>{$data.ip}</td>
                </tr>
                <tr>
                    <td>服务器域名</td>
                    <td>{$data.host_name}</td>
                </tr>
                <tr>
                    <td>服务器端口</td>
                    <td>{$data.server_port}</td>
                </tr>
                <tr>
                    <td>php版本</td>
                    <td>{$data.php_version}</td>
                </tr>
                <tr>
                    <td>服务器系统</td>
                    <td>{$data.system_info}</td>
                </tr>
                <tr>
                    <td>php运行方式</td>
                    <td>{$data.php_run_method}</td>
                </tr>
                <tr>
                    <td>web运行环境</td>
                    <td>{$data.web_server}</td>
                </tr>
                <tr>
                    <td>通信协议名称及版本</td>
                    <td>{$data.http_info}</td>
                </tr>
            </table>
        </div>
        <div style="width: 300px;height:500px;float:left;border: 0px solid gray;margin-top: 137px;margin-left: 20px">
            <span style="font-size: 23px;font-family: 华文楷体"><span class="glyphicon glyphicon-stats"> <font
                    style="vertical-align：Inherit;"><font
                    style="vertical-align：Inherit;">用户访问数据统计</font></font></span></span>
            <div id="main" style="width:400px;height:333px;background: white;border-radius: 10px"></div>
        </div>
        <div class="layui-collapse">
            <div class="layui-colla-item" style="width: 400px;float: right">
                <h2 class="layui-colla-title bg-primary" style="border-radius: 6px"> <span
                        style="font-size: 23px;font-family: 华文楷体;"><i
                        class="layui-icon" style="font-size: 20px">&#xe645;</i> <b>公告信息</b></span></h2>
                <div class="layui-colla-content layui-show">
                    <div>
                        <marquee behavior="" direction=""
                                 style="font-size: 20px;font-family: 华文楷体;color: white"><b>{$Request.session.admin_name}您好！新的一天！撸起袖子起来干!</b>
                        </marquee>
                    </div>
                </div>
            </div>
        </div>
        <div style="width:420px;height:500px;float: right;margin-top: 135px;position:
                absolute;margin-left: 898px">
            <span style="font-size: 23px;font-family: 华文楷体"><span class="glyphicon glyphicon-thumbs-up"> <font
                    style="vertical-align：Inherit;"><font
                    style="vertical-align：Inherit;">用户点击统计</font></font></span></span>
            <div class="echarts" id="years"
                 style="width:420px;height:333px;background: white;border-radius: 10px;"></div>
        </div>

        {/block}

    </div>
</div>
</body>
</html>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));
    console.log(myChart)

    myChart.setOption({
        title: {
            text: '用户分布',
            x: 'center',
            subtext: '用户量',
            borderColor: '#ccc',
        },
        tooltip: {},
        series: [
            {
                name: '访问来源',
                type: 'pie',    // 设置图表类型为饼图
                radius: '55%',  // 饼图的半径，外半径为可视区尺寸（容器高宽中较小一项）的 55% 长度。
                data: [          // 数据数组，name 为数据项名称，value 为数据项值
                    {value: 235, name: '视频广告'},
                    {value: 274, name: '联盟广告'},
                    {value: 310, name: '好友推介'},
                    {value: 335, name: '直接访问'},
                    {value: 400, name: '搜索引擎'}
                ]
            }
        ],
        legend: {
            data: ['销量']
        },
        textStyle: { //主标题文本样式{"fontSize": 18,"fontWeight": "bolder","color": "#333"}
            fontFamily: '楷体',
            fontSize: 18,
            fontStyle: 'normal',
            fontWeight: 'normal',
        },
    })


    // 基于准备好的dom，初始化echarts实例
    var me = echarts.init(document.getElementById('years'));

    option = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'cross',
                crossStyle: {
                    color: '#999'
                }
            }
        },
        toolbox: {
            feature: {
                dataView: {show: true, readOnly: false},
                magicType: {show: true, type: ['line', 'bar']},
                restore: {show: true},
                saveAsImage: {show: true}
            }
        },
        legend: {
            data: ['白天', '晚上']
        },
        xAxis: [
            {
                type: 'category',
                data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
                axisPointer: {
                    type: 'shadow'
                }
            }
        ],
        yAxis: [
            {
                type: 'value',
                name: '访问量',
                min: 0,
                max: 90,
                interval: 50,
                axisLabel: {
                    formatter: '{value} 次'
                }
            },
            {
                type: 'value',
                name: '点击量',
                min: 0,
                max: 25,
                interval: 5,
                axisLabel: {
                    formatter: '{value} 次'
                }
            }
        ],
        series: [
            {
                name: '白天',
                type: 'bar',
                data: [2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
            },
            {
                name: '晚上',
                type: 'bar',
                data: [2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2, 48.7, 18.8, 6.0, 2.3]
            },
        ]
    };

    // 使用刚指定的配置项和数据显示图表。
    me.setOption(option);
    /**
     * @desc 修改用户
     * @author Carver
     * @date 2020-07-28
     */
    $(document).on("click", "#ups_data", function () {
        console.log(1111111111)
        var up_id = $(this).attr("up_id");
        layui.use(['layer', 'form', 'upload'], function () {
            var layer = layui.layer;
            var form = layui.form;
            var upload = layui.upload, $ = layui.jquery;
            layer.open({
                type: 1,
                skin: 'layui-layer-demo',
                title: "修改用户",
                closeBtn: 2,
                shift: 6,
                area: ['500px', '500px'],
                shadeClose: true,
                shade: 0.5,
                content: $("#up_form"),
                success: function () {
                    $("#up_form").show();
                    $.ajax({
                        url: "/admin/updateAdmin",
                        type: "post",
                        data: {id: up_id},
                        dataType: "json",
                        success: function (data) {
                            if (data.code == 1) {
                                $('[name=user_name]').val(data.data.admin_name)
                                $('[name=user_email]').val(data.data.admin_email)
                                $('[name=user_pwd]').val(data.data.admin_pwd)
                                $('[name=user_repwd]').val(data.data.admin_pwd)
                                $('[name=user_auth]').val(data.data.role_id).addClass("layui-this").attr("selected", true);
                                $('[name=user_id]').val(up_id);
                            }
                        }
                    })
                }

            });

            //表单提交
            form.on('submit(carvers)', function (data) {
                var user_pwd = data.field['user_pwd'];
                var user_repwd = data.field['user_repwd'];
                if (user_pwd != user_repwd) {
                    layer.msg("两次密码不一致~");
                    return false;
                }
                $.ajax({
                    type: "POST",
                    url: "/admin/doUpdateAdmin",
                    data: data.field,
                    dataType: "json",
                    success: function (data) {
                        layer.msg(data.msg);
                        window.location.href = "/admin/adminList";
                    }
                });
                return false;
            });


            //文件上传
            upload.render({
                elem: '#up_img_upload' //绑定元素
                , url: "/admin/admin/uploadInfo"
                , accept: 'images'
                , done: function (res) {
                    console.log(res)
                    layer.close(index);
                    //上传完毕回调
                    if (res.code == 1) {
                        $('input[name="user_image"]').val(res.data);
                        $('#up_img_upload i').html("&#xe605;<span style='font-family: 华文楷体'>上传成功</span>");
                    }
                }
                , error: function () {
                    //请求异常回调
                    layer.msg("您上传的接口出错啦~");
                }
                , before: function () {
                    index = layer.load(1);
                }
            });
        })
    })
</script>
